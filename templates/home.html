<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>وبلاگ تکنولوژی</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body {
            font-family: 'Vazirmatn', 'Tahoma', sans-serif;
        }

        .gradient-text {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .post-card {
            background: linear-gradient(135deg, #374151 0%, #1f2937 100%);
            border: 1px solid rgba(75, 85, 99, 0.3);
            transition: all 0.3s ease;
        }

        .post-card:hover {
            transform: translateY(-4px);
            border-color: rgba(59, 130, 246, 0.5);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
        }

        .loading-skeleton {
            background: linear-gradient(90deg, #374151 25%, #4b5563 50%, #374151 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Bootstrap carousel styling is built-in */

        .category-btn {
            transition: all 0.3s ease;
        }

        .category-btn:hover {
            transform: translateY(-2px);
        }

        .category-btn.active {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- Header -->
    <header class="bg-gradient-to-r from-gray-800 to-gray-900 shadow-2xl border-b border-gray-700">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="text-3xl ml-4">💻</div>
                    <h1 class="text-3xl font-bold gradient-text">
                        وبلاگ تکنولوژی
                    </h1>
                </div>
                <nav class="hidden md:flex space-x-8 space-x-reverse">
                    <a href="#" class="text-gray-300 hover:text-white transition-colors">خانه</a>
                    <a href="#posts-section" class="text-gray-300 hover:text-white transition-colors">مقالات</a>
                    <a href="#" class="text-gray-300 hover:text-white transition-colors">درباره ما</a>
                    <a href="#" class="text-gray-300 hover:text-white transition-colors">تماس</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Hero Slider -->
    <section class="position-relative">
        <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">
            <div class="carousel-indicators">
                <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" class="active"></button>
                <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1"></button>
                <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="2"></button>
            </div>

            <div class="carousel-inner">
                <!-- Slide 1 -->
                <div class="carousel-item active">
                    <div class="d-flex align-items-center justify-content-center text-center text-white position-relative" style="height: 500px; background: linear-gradient(135deg, #3b82f6, #8b5cf6);">
                        <div class="position-absolute w-100 h-100" style="background: linear-gradient(45deg, rgba(0,0,0,0.3), rgba(0,0,0,0.1));"></div>
                        <div class="position-relative z-3 px-4">
                            <h2 class="display-3 fw-bold mb-4">🚀 آینده برنامه‌نویسی</h2>
                            <p class="fs-4 text-light mb-4">با جدیدترین تکنولوژی‌ها آشنا شوید</p>
                            <button class="btn btn-light btn-lg rounded-pill px-5 py-3 fw-bold" style="color: #3b82f6;">
                                شروع کنید
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Slide 2 -->
                <div class="carousel-item">
                    <div class="d-flex align-items-center justify-content-center text-center text-white position-relative" style="height: 500px; background: linear-gradient(135deg, #059669, #0d9488);">
                        <div class="position-absolute w-100 h-100" style="background: linear-gradient(45deg, rgba(0,0,0,0.3), rgba(0,0,0,0.1));"></div>
                        <div class="position-relative z-3 px-4">
                            <h2 class="display-3 fw-bold mb-4">🤖 هوش مصنوعی</h2>
                            <p class="fs-4 text-light mb-4">دنیای AI و Machine Learning را کشف کنید</p>
                            <button class="btn btn-light btn-lg rounded-pill px-5 py-3 fw-bold" style="color: #059669;">
                                بیشتر بدانید
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Slide 3 -->
                <div class="carousel-item">
                    <div class="d-flex align-items-center justify-content-center text-center text-white position-relative" style="height: 500px; background: linear-gradient(135deg, #ea580c, #dc2626);">
                        <div class="position-absolute w-100 h-100" style="background: linear-gradient(45deg, rgba(0,0,0,0.3), rgba(0,0,0,0.1));"></div>
                        <div class="position-relative z-3 px-4">
                            <h2 class="display-3 fw-bold mb-4">🌐 توسعه وب</h2>
                            <p class="fs-4 text-light mb-4">از Frontend تا Backend، همه چیز را یاد بگیرید</p>
                            <button class="btn btn-light btn-lg rounded-pill px-5 py-3 fw-bold" style="color: #ea580c;">
                                آموزش ببینید
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon"></span>
                <span class="visually-hidden">قبلی</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon"></span>
                <span class="visually-hidden">بعدی</span>
            </button>
        </div>
    </section>

    <!-- Posts Section -->
    <main class="container mx-auto px-4 py-12" id="posts-section">
        <!-- Category Filter -->
        <div class="mb-8">
            <h3 class="text-xl font-bold mb-4 text-gray-300">دسته‌بندی‌ها:</h3>
            <div id="category-filters" class="flex flex-wrap gap-3">
                <button
                    onclick="filterByCategory(null)"
                    class="category-btn active px-4 py-2 rounded-full bg-gray-700 text-white font-semibold"
                >
                    همه مقالات
                </button>
                <!-- Categories will be loaded here -->
            </div>
        </div>

        <!-- Posts Grid -->
        <div class="mb-8">
            <h2 class="text-3xl font-bold mb-8 gradient-text text-center">📚 آخرین مقالات</h2>

            <!-- Loading State -->
            <div id="posts-loading" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Loading skeletons -->
                <div class="post-card rounded-xl overflow-hidden">
                    <div class="loading-skeleton h-48"></div>
                    <div class="p-6">
                        <div class="loading-skeleton h-4 w-20 rounded mb-2"></div>
                        <div class="loading-skeleton h-6 w-full rounded mb-3"></div>
                        <div class="loading-skeleton h-4 w-3/4 rounded mb-4"></div>
                        <div class="flex justify-between items-center">
                            <div class="loading-skeleton h-4 w-24 rounded"></div>
                            <div class="loading-skeleton h-8 w-20 rounded"></div>
                        </div>
                    </div>
                </div>
                <div class="post-card rounded-xl overflow-hidden">
                    <div class="loading-skeleton h-48"></div>
                    <div class="p-6">
                        <div class="loading-skeleton h-4 w-20 rounded mb-2"></div>
                        <div class="loading-skeleton h-6 w-full rounded mb-3"></div>
                        <div class="loading-skeleton h-4 w-3/4 rounded mb-4"></div>
                        <div class="flex justify-between items-center">
                            <div class="loading-skeleton h-4 w-24 rounded"></div>
                            <div class="loading-skeleton h-8 w-20 rounded"></div>
                        </div>
                    </div>
                </div>
                <div class="post-card rounded-xl overflow-hidden">
                    <div class="loading-skeleton h-48"></div>
                    <div class="p-6">
                        <div class="loading-skeleton h-4 w-20 rounded mb-2"></div>
                        <div class="loading-skeleton h-6 w-full rounded mb-3"></div>
                        <div class="loading-skeleton h-4 w-3/4 rounded mb-4"></div>
                        <div class="flex justify-between items-center">
                            <div class="loading-skeleton h-4 w-24 rounded"></div>
                            <div class="loading-skeleton h-8 w-20 rounded"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Posts Grid -->
            <div id="posts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 hidden"></div>

            <!-- No Posts Message -->
            <div id="no-posts" class="text-center py-16 hidden">
                <div class="text-6xl mb-4">📝</div>
                <h3 class="text-2xl font-bold mb-4 text-gray-300">هیچ مقاله‌ای یافت نشد</h3>
                <p class="text-gray-400">در این دسته‌بندی مقاله‌ای موجود نیست.</p>
            </div>
        </div>

        <!-- Pagination -->
        <div id="pagination" class="flex justify-center items-center space-x-4 space-x-reverse hidden">
            <button
                id="prev-btn"
                onclick="loadPreviousPage()"
                class="bg-gray-700 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                disabled
            >
                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
                صفحه قبل
            </button>

            <span id="page-info" class="text-gray-300 px-6 py-3 bg-gray-800 rounded-lg">
                صفحه <span id="current-page">1</span>
            </span>

            <button
                id="next-btn"
                onclick="loadNextPage()"
                class="bg-gray-700 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                disabled
            >
                صفحه بعد
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </button>
        </div>
    </main>

    <script>
        // API Configuration
        const POSTS_API = 'http://127.0.0.1:8000/api/posts/';
        const CATEGORIES_API = 'http://127.0.0.1:8000/api/category/';

        // State
        let currentPage = 1;
        let currentCategory = null;
        let nextPageUrl = null;
        let previousPageUrl = null;
        let isLoading = false;
        let categories = [];

        // Bootstrap carousel is handled automatically

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Convert datetime to Persian relative time
        function getRelativeTimePersian(dateString) {
            const now = new Date();
            const publishedDate = new Date(dateString);
            const diffInSeconds = Math.floor((now - publishedDate) / 1000);

            if (diffInSeconds < 60) {
                return `${diffInSeconds} ثانیه پیش`;
            }

            const diffInMinutes = Math.floor(diffInSeconds / 60);
            if (diffInMinutes < 60) {
                return `${diffInMinutes} دقیقه پیش`;
            }

            const diffInHours = Math.floor(diffInMinutes / 60);
            if (diffInHours < 24) {
                return `${diffInHours} ساعت پیش`;
            }

            const diffInDays = Math.floor(diffInHours / 24);
            if (diffInDays < 30) {
                return `${diffInDays} روز پیش`;
            }

            const diffInMonths = Math.floor(diffInDays / 30);
            if (diffInMonths < 12) {
                return `${diffInMonths} ماه پیش`;
            }

            const diffInYears = Math.floor(diffInMonths / 12);
            return `${diffInYears} سال پیش`;
        }

        // Fetch categories
        async function fetchCategories() {
            try {
                const response = await fetch(CATEGORIES_API);
                if (response.ok) {
                    categories = await response.json();
                    displayCategoryFilters();
                }
            } catch (error) {
                console.error('Error fetching categories:', error);
            }
        }

        // Display category filters
        function displayCategoryFilters() {
            const filtersContainer = document.getElementById('category-filters');
            const allButton = filtersContainer.querySelector('.category-btn');

            categories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'category-btn px-4 py-2 rounded-full bg-gray-700 text-white font-semibold';
                button.textContent = escapeHtml(category.name);
                button.onclick = () => filterByCategory(category.id);
                filtersContainer.appendChild(button);
            });
        }

        // Filter by category
        function filterByCategory(categoryId) {
            currentCategory = categoryId;
            currentPage = 1;

            // Update active button
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            fetchPosts();
        }

        // Build API URL with filters and pagination
        function buildApiUrl(page = 1, category = null) {
            let url = POSTS_API;
            const params = new URLSearchParams();

            if (page > 1) {
                params.append('page', page);
            }

            if (category) {
                params.append('category', category);
            }

            if (params.toString()) {
                url += '?' + params.toString();
            }

            return url;
        }

        // Fetch posts
        async function fetchPosts(url = null) {
            if (isLoading) return;

            isLoading = true;

            // Show loading state
            document.getElementById('posts-loading').classList.remove('hidden');
            document.getElementById('posts-grid').classList.add('hidden');
            document.getElementById('no-posts').classList.add('hidden');
            document.getElementById('pagination').classList.add('hidden');

            try {
                const apiUrl = url || buildApiUrl(currentPage, currentCategory);
                console.log('Fetching posts from:', apiUrl);

                const response = await fetch(apiUrl);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                console.log('Posts data:', data);

                // Update pagination info
                nextPageUrl = data.next;
                previousPageUrl = data.previous;

                // Display posts
                displayPosts(data.results);

                // Update pagination
                updatePagination(data.count);

                // Hide loading
                document.getElementById('posts-loading').classList.add('hidden');

            } catch (error) {
                console.error('Error fetching posts:', error);
                showError('خطا در بارگذاری مقالات');
            } finally {
                isLoading = false;
            }
        }

        // Display posts
        function displayPosts(posts) {
            const postsGrid = document.getElementById('posts-grid');
            const noPosts = document.getElementById('no-posts');

            if (posts.length === 0) {
                postsGrid.classList.add('hidden');
                noPosts.classList.remove('hidden');
                return;
            }

            noPosts.classList.add('hidden');
            postsGrid.classList.remove('hidden');

            postsGrid.innerHTML = posts.map(post => `
                <article class="post-card rounded-xl overflow-hidden">
                    <div class="relative">
                        ${post.featured_image ? `
                            <img
                                src="${escapeHtml(post.featured_image)}"
                                alt="${escapeHtml(post.title)}"
                                class="w-full h-48 object-cover"
                                onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDQwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjMzc0MTUxIi8+CjxwYXRoIGQ9Ik0xNzUgNzVIMjI1VjEyNUgxNzVWNzVaIiBmaWxsPSIjNkI3Mjg5Ii8+CjxwYXRoIGQ9Ik0xODUgOTVIMjE1VjEwNUgxODVWOTVaIiBmaWxsPSIjOUI5Q0E0Ii8+Cjx0ZXh0IHg9IjIwMCIgeT0iMTUwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjOUI5Q0E0IiBmb250LXNpemU9IjE0Ij7Yqti12YjbjNixPC90ZXh0Pgo8L3N2Zz4K'; this.alt='تصویر موجود نیست';"
                            >
                        ` : `
                            <div class="w-full h-48 bg-gradient-to-br from-gray-600 to-gray-700 flex items-center justify-center">
                                <div class="text-center text-gray-400">
                                    <svg class="w-16 h-16 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                    <p class="text-sm">بدون تصویر</p>
                                </div>
                            </div>
                        `}
                        <div class="absolute top-4 right-4">
                            <span class="bg-gradient-to-r from-blue-600 to-purple-600 px-3 py-1 text-xs font-semibold text-white rounded-full">
                                ${escapeHtml(post.category)}
                            </span>
                        </div>
                    </div>

                    <div class="p-6">
                        <h3 class="text-xl font-bold mb-3 text-white line-clamp-2">
                            ${escapeHtml(post.title)}
                        </h3>

                        <div class="flex items-center justify-between text-sm text-gray-400 mb-4">
                            <div class="flex items-center space-x-4 space-x-reverse">
                                <span class="flex items-center">
                                    <svg class="w-4 h-4 ml-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                                    </svg>
                                    ${escapeHtml(post.author)}
                                </span>
                                <span class="flex items-center">
                                    <svg class="w-4 h-4 ml-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                                    </svg>
                                    ${getRelativeTimePersian(post.published_at)}
                                </span>
                            </div>
                        </div>

                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4 space-x-reverse text-sm text-gray-400">
                                <span class="flex items-center">
                                    <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                                    </svg>
                                    ${post.comments} نظر
                                </span>
                                <span class="flex items-center text-red-400">
                                    <svg class="w-4 h-4 ml-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path>
                                    </svg>
                                    ${post.likes}
                                </span>
                            </div>

                            <a
                                href="/post/${encodeURIComponent(post.slug)}/"
                                class="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-all duration-300 transform hover:scale-105"
                            >
                                ادامه مطلب
                            </a>
                        </div>
                    </div>
                </article>
            `).join('');
        }

        // Update pagination
        function updatePagination(totalCount) {
            const pagination = document.getElementById('pagination');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const currentPageSpan = document.getElementById('current-page');

            if (totalCount > 9) {
                pagination.classList.remove('hidden');

                prevBtn.disabled = !previousPageUrl;
                nextBtn.disabled = !nextPageUrl;

                currentPageSpan.textContent = currentPage;

                if (previousPageUrl) {
                    prevBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                } else {
                    prevBtn.classList.add('opacity-50', 'cursor-not-allowed');
                }

                if (nextPageUrl) {
                    nextBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                } else {
                    nextBtn.classList.add('opacity-50', 'cursor-not-allowed');
                }
            } else {
                pagination.classList.add('hidden');
            }
        }

        // Load next page
        function loadNextPage() {
            if (nextPageUrl && !isLoading) {
                currentPage++;
                fetchPosts(nextPageUrl);
            }
        }

        // Load previous page
        function loadPreviousPage() {
            if (previousPageUrl && !isLoading) {
                currentPage--;
                fetchPosts(previousPageUrl);
            }
        }

        // Show error
        function showError(message) {
            document.getElementById('posts-loading').classList.add('hidden');
            document.getElementById('posts-grid').innerHTML = `
                <div class="col-span-full text-center py-16">
                    <div class="text-6xl mb-4">😕</div>
                    <h3 class="text-2xl font-bold mb-4 text-red-400">${escapeHtml(message)}</h3>
                    <button onclick="fetchPosts()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors">
                        تلاش مجدد
                    </button>
                </div>
            `;
            document.getElementById('posts-grid').classList.remove('hidden');
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            fetchCategories();
            fetchPosts();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97bffd69b0245cc8',t:'MTc1NzM1MDY5OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
